Version 4
SHEET 1 2804 3680
WIRE -16 -240 -208 -240
WIRE -80 -208 -128 -208
WIRE -208 -192 -208 -240
WIRE -80 -192 -80 -208
WIRE -208 -96 -208 -112
WIRE -128 -96 -128 -208
WIRE -128 -96 -208 -96
WIRE -80 -96 -80 -112
WIRE -16 -96 -80 -96
WIRE -80 -64 -80 -96
WIRE 368 0 304 0
WIRE 512 0 448 0
WIRE 544 0 512 0
WIRE -224 16 -288 16
WIRE -80 16 -144 16
WIRE -48 16 -80 16
WIRE 544 16 544 0
WIRE 576 16 544 16
WIRE 608 16 576 16
WIRE -48 32 -48 16
WIRE -16 32 -48 32
WIRE 16 32 -16 32
WIRE 512 32 512 0
WIRE 576 32 576 16
WIRE -80 48 -80 16
WIRE -16 48 -16 32
WIRE 576 112 576 96
WIRE -16 128 -16 112
WIRE 512 144 512 96
WIRE 512 144 368 144
WIRE 576 144 576 112
WIRE 576 144 512 144
WIRE -80 160 -80 112
WIRE -80 160 -224 160
WIRE -16 160 -16 128
WIRE -16 160 -80 160
WIRE 368 160 368 144
WIRE -224 176 -224 160
WIRE 592 336 368 336
WIRE 736 336 672 336
WIRE 768 336 736 336
WIRE 768 352 768 336
WIRE 800 352 768 352
WIRE 832 352 800 352
WIRE 368 368 368 336
WIRE 736 368 736 336
WIRE 800 368 800 352
WIRE -272 480 -336 480
WIRE -128 480 -192 480
WIRE -96 480 -128 480
WIRE 368 480 368 448
WIRE 736 480 736 432
WIRE 736 480 368 480
WIRE 800 480 800 448
WIRE 800 480 736 480
WIRE -96 496 -96 480
WIRE -64 496 -96 496
WIRE -32 496 -64 496
WIRE 368 496 368 480
WIRE -128 512 -128 480
WIRE -64 512 -64 496
WIRE -128 624 -128 576
WIRE -128 624 -272 624
WIRE -64 624 -64 592
WIRE -64 624 -128 624
WIRE -272 640 -272 624
WIRE 480 656 384 656
WIRE 384 704 384 656
WIRE 384 832 384 784
WIRE 384 848 384 832
WIRE 336 896 224 896
WIRE 752 912 656 912
WIRE -160 960 -256 960
WIRE 656 960 656 912
WIRE 272 976 224 976
WIRE 336 976 272 976
WIRE -256 1008 -256 960
WIRE 272 1040 272 976
WIRE 656 1056 656 1040
WIRE 656 1072 656 1056
WIRE -256 1184 -256 1088
WIRE -256 1200 -256 1184
FLAG 368 496 0
FLAG -80 -64 0
FLAG -16 -240 PLUS
IOPIN -16 -240 Out
FLAG -16 -96 MINUS
IOPIN -16 -96 Out
FLAG 832 352 L
IOPIN 832 352 Out
FLAG 272 1040 0
FLAG 384 832 0
FLAG -256 1184 0
FLAG -160 960 gm
FLAG 480 656 gp
FLAG 656 1056 0
FLAG 752 912 Lmax
FLAG 16 32 L2
IOPIN 16 32 Out
FLAG -224 176 0
FLAG -288 16 PLUS
FLAG -32 496 L24
IOPIN -32 496 Out
FLAG -272 640 0
FLAG -336 480 PLUS
FLAG 608 16 L3
IOPIN 608 16 Out
FLAG 368 160 0
FLAG 304 0 PLUS
SYMBOL bv 368 352 R0
WINDOW 3 41 147 Left 2
SYMATTR Value V=min(gm(V(PLUS,MINUS)),max(gp(V(PLUS,MINUS)),V(L)))
SYMATTR InstName B1
SYMBOL res 688 320 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 -31 -209 VTop 2
SYMATTR InstName R1
SYMATTR Value R=10000*exp(-abs(V(PLUS,MINUS))/v0)
SYMBOL cap 720 368 R0
SYMATTR InstName C1
SYMATTR Value 0.1
SYMBOL voltage -80 -208 R0
WINDOW 3 -346 -65 Left 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR Value PULSE(0 7.5 0.02 0 0 0.001 .01 10)
SYMATTR InstName V1
SYMBOL res 784 352 R0
SYMATTR InstName R2
SYMATTR Value R=if(ddt(V(L))>-0.2,1000000000,.1)
SYMBOL voltage 224 880 R0
WINDOW 3 40 70 Left 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
WINDOW 0 86 36 Left 2
SYMATTR Value SINE(0 5 1)
SYMATTR InstName V2
SYMBOL bv 384 688 R0
WINDOW 3 51 52 Left 2
SYMATTR Value V=gp(V(PLUS,MINUS))
SYMATTR InstName B2
SYMBOL bv -256 992 R0
WINDOW 3 658 263 Center 2
SYMATTR Value V={sgn(V(PLUS,MINUS))*(1/(a*Rs)*w(a*Rs*I0(V(Lmax))*exp(a*(abs(V(PLUS,MINUS))+Rs*I0(V(Lmax)))))-I0(V(Lmax)))}
SYMATTR InstName B3
SYMBOL bv 656 944 R0
WINDOW 3 36 95 Left 2
SYMATTR Value V=gp(V(L24))
SYMATTR InstName B4
SYMBOL res -128 0 R90
WINDOW 0 -1 74 VBottom 2
WINDOW 3 -48 112 VTop 2
SYMATTR InstName R3
SYMATTR Value R=0.05
SYMBOL cap -96 48 R0
SYMATTR InstName C2
SYMATTR Value .001
SYMBOL voltage -208 -208 R0
WINDOW 3 -212 -107 Left 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR Value PULSE(0 15 0.01 0 0 0.001 .02 1)
SYMATTR InstName V3
SYMBOL res -176 464 R90
WINDOW 0 -1 74 VBottom 2
WINDOW 3 -92 -92 VTop 2
SYMATTR InstName R5
SYMATTR Value R=10000000*exp(-abs(V(PLUS,MINUS))/v0)
SYMBOL cap -144 512 R0
SYMATTR InstName C3
SYMATTR Value 10
SYMBOL res -80 496 R0
SYMATTR InstName R6
SYMATTR Value R=0.1
SYMBOL res -32 32 R0
SYMATTR InstName R4
SYMATTR Value R= 0.3
SYMBOL res 464 -16 R90
WINDOW 0 -1 74 VBottom 2
WINDOW 3 -48 112 VTop 2
SYMATTR InstName R7
SYMATTR Value R=1000
SYMBOL cap 496 32 R0
SYMATTR InstName C4
SYMATTR Value 0.1
SYMBOL res 560 16 R0
SYMATTR InstName R8
SYMATTR Value R= 10000
TEXT 296 -328 Left 2 !.func gp(V) {1/(1+exp(-np*(V-vp)))}\n.func gm(V) {1/(1+exp(-nm*(V+vm)))}
TEXT 296 -256 Left 2 !.params vp=8.5 np=4 vm=-2  nm=4 L0=1e-10    imax=1e-2 a=1 Rs=1e2  imin=1e-6    RL=1e4 CL=.8 Rm=1e10 RF=4e3 v0=0.3
TEXT -424 -392 Left 2 !.tran 0 .2 0 0.001 startup uic
TEXT 320 -456 Left 2 !.func w(x) {log(1+x)*(1-(log(1+log(1+x)))/(2+log(1+x)))}\n.func I0(L) {imax*L+imin*(1-L)}
